---
title: Use Redpanda with NodeJS
---

<head>
    <meta name="title" content="Use Redpanda with NodeJS | Redpanda Docs"/>
    <meta name="description" content="How to produce to and consume from Redpanda using Node.js."/>
    <link rel="canonical" href="https://docs.redpanda.com/docs/develop/guide-nodejs/" />
</head>

import ThemedImage from '@theme/ThemedImage';
import useBaseUrl from '@docusaurus/useBaseUrl';

Create a basic chat room application with Redpanda and Kafka clients developed with [kafkajs](https://kafka.js.org/). This guide describes how to:

- Bring up a Redpanda cluster to store and stream chat room messages.
- Code a client application in Typescript using kafkajs that produces and consumes chat room messages.
- Build and run multiple clients to exchange chat messages streamed through Redpanda.

## Prerequisites

### Install Node

[Install Node.js for your platform](https://nodejs.org/en/download/package-manager/).

### Set up Redpanda environment

Follow the [Redpanda Quickstart](../../get-started/quick-start) to spin up a development
environment in Docker with either one or three brokers.

:::caution
If you're running Redpanda on your laptop, or in a shared development
environment, then avoid Redpanda's optimized production settings. Avoid running
`sudo rpk redpanda tune all` or manually configuring Redpanda for production, as they
might affect your experience with other applications running on your machine.
:::

### Set up example environment

1. Create and set your working directory to the project folder, `redpanda-node`:

   ```bash
   mkdir redpanda-node
   cd redpanda-node
   ```

2. Generate `package.json`:

   ```bash
   npm init
   ```

   For each subsequent prompt, accept the default value.

3. Install the required dependencies: 

   ```bash
   npm i -D typescript
   npm i -D @types/node
   npm i kafkajs
   npm i uuid
   npm i -D @types/uuid
   ```

4. Generate a `tsconfig.json` file:

   ```bash
   tsc --init
   ```

5. In `redpanda-node/`, create a `src/` directory for source files:

    ```bash
    mkdir src
    ```

## Create a topic

Create a topic named `chat-room` for both Redpanda and the client.

### Create in Redpanda

With your Redpanda Docker container, use [rpk](../../reference/rpk) to create a `chat-room` topic:

```bash
docker exec -it redpanda-0 rpk topic create chat-room
```

  <details>
  <summary>
  Expected output
  </summary>

  ```
  TOPIC      STATUS
  chat-room  OK
  ```

  </details>

Verify that `chat-room` was created successfully by listing all created topics:

```bash
docker exec -it redpanda-0 rpk topic list
```

  <details>
  <summary>
  Expected output
  </summary>

  ```
  NAME       PARTITIONS  REPLICAS
  chat-room  1           1
  ```

  </details>


### Create in client

To create a topic for the client, in `redpanda-node/` create a source file `src/admin.ts` with the following content. 

:::note
These sample files assume you're running the Redpanda quickstart, where the external port for broker `redpanda-0` is set to port 19092. Make sure to edit the broker's port if you're running something different.
:::

```javascript title="src/admin.ts"
import {Kafka} from "kafkajs"

const redpanda = new Kafka({
  brokers: ["localhost:19092"]
})
const admin = redpanda.admin()

export function createTopic(topic: string, partitions?: number, replicas?: number) {
  return admin.connect().then(() => {
    admin.createTopics({
      topics: [{
        topic: topic,
        numPartitions: partitions ? partitions : 1,
        replicationFactor: replicas ? replicas : 1,
      }]
    }).then(() => admin.disconnect())
  })
}
```

## Create a producer

A client needs a producer to publish `chat-room` topic messages.

To create a producer for the client, in `redpanda-node/` create a source file `src/producer.ts` with the following content. 

:::note
These sample files assume you're running the Redpanda quickstart, where the external port for broker `redpanda-0` is set to port 19092. Make sure to edit the broker's port if you're running something different.
:::

```javascript title="src/producer.ts"
import {Kafka} from "kafkajs"

const redpanda = new Kafka({
  brokers: ["localhost:19092"]
})
const producer = redpanda.producer()

export function getConnection(user: string) {
  return producer.connect().then(() => {
    return (message: string) => {
      return producer.send({
        topic: "chat-room",
        messages: [{value: JSON.stringify({message, user})},],
      })
    }
  })
}

export function disconnect() {
  return producer.disconnect()
}
```

You now have a working producer that sends strings entered by the user to the 
`chat-room` topic. Messages are sent as JSON encoded strings here,
but keep in mind that the producer only sends buffers, so you can encode the
messages however you like.

## Create a consumer

A client needs a consumer to receive `chat-room` topic messages.

To create a consumer for the client, in `redpanda-node/` create a source file `src/consumer.ts` with the following content. 

```javascript title="src/consumer.ts"
import {Kafka} from "kafkajs"
import {v4 as uuidv4} from "uuid"

const redpanda = new Kafka({
  brokers: ["localhost:19092"]
})
const consumer = redpanda.consumer({groupId: uuidv4()})

export function connect() {
  return consumer.connect().then(() =>
    consumer.subscribe({topic: "chat-room"}).then(() =>
      consumer.run({
        eachMessage: async ({topic, partition, message}) => {
          const formattedValue = JSON.parse((message.value as Buffer).toString())
          console.log(`${formattedValue.user}: ${formattedValue.message}`)
        },
      })
    )
  )
}

export function disconnect() {
  consumer.disconnect()
}
```

You now have a consumer that reads all messages from the `chat-room`
topic and prints them to the console. You can start as many consumer groups as
you like, but remember that each group reads a message only once, which is
why the example is using a generated UUID for the group ID.

:::note
Because `eachMessage()` automatically commits on a heartbeat interval, there is no `commit()` method or auto-commit configuration in the code.
:::

## Create a client application

The client needs an application that creates the topic, producer, and consumer and implements the chat logic.

To create a client application, in `redpanda-node/` create a source file `src/index.ts` with the following content.

```javascript title="src/index.ts"
import * as readline from "node:readline"
import * as Admin from "./admin"
import * as Producer from "./producer"
import * as Consumer from "./consumer"

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
})

function start() {
  const topic = "chat-room"
  console.log(`Creating topic: ${topic}`)
  Admin.createTopic(topic).then(() => {
    console.log("Connecting...")
    Consumer.connect().then(() => {
      rl.question("Enter user name: \n", function (username) {
        Producer.getConnection(username).then((sendMessage) => {
          console.log("Connected, press Ctrl+C to exit")
          rl.on("line", (input) => {
            readline.moveCursor(process.stdout, 0, -1)
            sendMessage(input);
          })
        })
      })
    })
  })  
}
start()

process.on("SIGINT", process.exit)
process.on("exit", () => {
  Producer.disconnect();
  Consumer.disconnect();
  rl.close();
})
``` 

## Build and run application

Build the client chat application, run it from multiple client terminals, and chat between the clients.

1. From `redpanda-node/`, build the client application:

  ```bash
  tsc src/index.ts
  ```

1. Open at least two terminals, and for each terminal:

    1. Run the client application:

      ```
      node src/index.js
      ```

    1. When prompted to `Enter user name:`, enter a unique name for the chat room.  

1. Use the chat application: enter a message in a terminal, and verify that the message is received in the other terminal(s).

  <details>
  <summary>Example output from Alice's terminal</summary>
  
  ```
  Enter user name: 
  Alice
  Connected, press Ctrl+C to exit
  Alice: Hi, I'm Alice
  Bob: Hi Alice, I'm Bob, nice to meet you
  ```

  </details>

    <details>
  <summary>Example output from Bob's terminal</summary>
  
  ```
  Enter user name: 
  Bob
  Connected, press Ctrl+C to exit
  Alice: Hi, I'm Alice
  Bob: Hi Alice, I'm Bob, nice to meet you
  ```
  
  </details>
