---
title: Configure Kafka TLS Encryption
---

<head>
    <meta name="title" content="Configure Encryption | Redpanda Docs"/>
    <meta name="description" content="Enable encryption with TLS or mTLS."/>
</head>

By default, Redpanda data is sent unencrypted. A security best practice is to enable encryption with TLS or mTLS. 

- Transport Layer Security (TLS), previously SSL, provides encryption for client-server communication. This prevents third parties from accessing data transferred between the client and server.  

- mTLS, or 2-way TLS, is a protocol that authenticates both the server and the client. In addition to the server certificate required in TLS, mTLS requires the client to give a certificate. This involves more overhead to implement, but it can be useful for environments that require additional security and only have a small number of verified clients.

See also: [Security for Redpanda in Kubernetes](../../kubernetes/security)

## Prerequisites

TLS certificates are necessary for encryption. You can use your own certificates, either self-signed or issued by a trusted certificate authority (CA), or you can follow these steps.

### Create certificate signing requests

#### Create node certificate configuration (node.cnf)

Depending on the address the client uses to connect to Redpanda, you might need to create a CNF file for each node to modify the `alt_names` section with organizational details. For production usage, update the `distinguished_name` section with DNS resolutions and IP address.

```bash  title="node.cnf"
[ req ]
prompt = no
distinguished_name = distinguished_name
req_extensions     = extensions

[ distinguished_name ]
organizationName = Redpanda

[ extensions ]
keyUsage         = critical,digitalSignature,keyEncipherment
extendedKeyUsage = serverAuth,clientAuth
subjectAltName   = @alt_names

[ alt_names ]
DNS.1 = localhost
DNS.2 = redpanda
DNS.3 = console
DNS.4 = connect
IP.1  = 127.0.0.1
```


Generate a 2048-bit RSA private key for nodes:

```bash
openssl genrsa -out node.key 2048
```

where:

| Output              | Description   |
| --------            | ------    | 
| `-out node.key`     | The public key certificate of the CA.    |  


Create a public certificate signing request (CSR) for the nodes:

```bash
openssl req -new -config node.cnf -key node.key -out node.csr
```

where:

| Inputs              | Description   |
| --------            | ------    | 
| `-new`                | New request.    | 
| `-config node.cnf`    | Configuration file to use when generating certificates (created above).    | 
| `-key node.key`         | Private key of the node (created above).    | 

| Output             | Description   |
| --------            | ------    | 
| `-out node.csr`     | The public key certificate of the CA.    |  

If generated by a corporate CA, these certificate signing requests must be signed with the following extensions:

```bash
keyUsage         = critical,digitalSignature,keyEncipherment
extendedKeyUsage = serverAuth,clientAuth
```

### Optional: Create a local CA for self-signed certificates

#### 1. Create the CA configuration file (ca.cnf)

You can edit the `distinguished_name` section with your own organization details.

```bash title="ca.cnf"
[ ca ]
default_ca = CA_default

[ CA_default ]
default_days    = 365
default_md      = sha256
unique_subject  = no

[ req ]
prompt = no
distinguished_name = distinguished_name
x509_extensions    = extensions

[ distinguished_name ]
organizationName = Redpanda
commonName       = Redpanda CA

[ extensions ]
keyUsage         = critical,digitalSignature,nonRepudiation,keyEncipherment,keyCertSign
basicConstraints = critical,CA:true,pathlen:1
```

#### 2. Generate CA private key and public certificate

Create a CA key to self-sign certificates:

```bash
openssl genrsa -out ca.key 2048
chmod 400 ca.key
```

Create a public certificate for the CA:

```bash
openssl req -new -x509 -config ca.cnf -key ca.key -days 365 -batch -out ca.crt
```

where:

| Inputs              | Description   |
| --------            | ------    | 
| `-new`              | New request    | 
| `-x509`             | Create an X.509 certificate instead of a certificate signing request (CSR).    | 
| `-config ca.cnf`    | Configuration file to use when generating certificates (created above).    | 
| `-key ca.key`       | Private key of the CA (created above).    | 
| `-days 365`         | Number of days signed certificates are valid.    | 
| `-batch`            | In batch mode, certificates are certified automatically.     | 

| Output             | Description   |
| --------            | ------    | 
| `-out ca.crt`       | The public key certificate of the CA.    |   

#### 3. Sign certificates

Sign and generate X.509 certificate for Redpanda node:

```bash
openssl x509 -req -signkey ca.key -days 365 -extfile node.cnf -extensions extensions -in node.csr -out node.crt
```

where: 

| Inputs             | Description   |
| --------           | ------    | 
| `-req`               | Input is a certificate request. Sign and output.    | 
| `-signkey ca.key`    | Private key of the CA (created above).    | 
| `-days 365`          | Number of days signed certificates are valid.    | 
| `-extfile node.cnf`  | Configuration file for CA.    | 
| `-extensions extensions` | Section in `node.cnf` to use when applying extensions.    | 
| `-in node.csr`       | Node certificate signing request (CSR generated above).    | 

| Output             | Description   |
| --------            | ------    | 
| `-out node.crt`     | The signed public key certificate for the node.    |           

## Configure TLS

To configure TLS, in `redpanda.yaml`, enter:

```yaml title="redpanda.yaml"
// highlight-start
  rpc_server_tls: {}
// highlight-end
  kafka_api:
    - address: 0.0.0.0
      port: 9092
      name: tls_listener
// highlight-start
  kafka_api_tls:
    - name: tls_listener
      key_file: server.key
      cert_file: server.crt
      truststore_file: ca.crt
      enabled: true
      require_client_auth: false
// highlight-end
// highlight-start
  admin_api_tls: []
// highlight-end
pandaproxy:
// highlight-start
  pandaproxy_api_tls: []
// highlight-end
schema_registry:
// highlight-start
  schema_registry_api_tls: []
// highlight-end
```

All APIs, except `rpc_server_tls`, support multiple listeners. 

See also: [Configure Listeners](../../security/listener-configuration)

## Configure mTLS 

To enable mTLS, add `require_client_auth` set to `true`. 

For example, for the Kafka API, in `redpanda.yaml`, enter: 

```yaml title="redpanda.yaml"
  kafka_api:
    - address: 0.0.0.0
      port: 9092
      name: mtls_listener
  kafka_api_tls:
    - name: mtls_listener
      key_file: mtls_server.key
      cert_file: mtls_server.crt
      truststore_file: mtls_ca.crt
      enabled: true
// highlight-start
      require_client_auth: true
// highlight-end
```

See also: [Configure Listeners](../../security/listener-configuration)

### Configure mTLS for a Kafka API listener

To enable mTLS for a Kafka API listener, edit `redpanda.yaml`:

```yaml title="redpanda.yaml"
  kafka_api:
// highlight-start
  - name: internal
// highlight-end
    address: 0.0.0.0
    port: 9092

  advertised_kafka_api:
  - name: internal
    address: <port-clients-connect-to>
    port: 9092

  kafka_api_tls:
// highlight-start
  - name: internal
    enabled: true
    require_client_auth: true
    cert_file: <path-to-PEM-formatted-cert-file>
    key_file: <path-to-PEM-formatted-key-file>
    truststore_file: <path-to-PEM-formatted-CA-file>
// highlight-end
```
:::note notes
- Remember to replace variables in brackets. 
- `kafka_api` is the listener declaration. This `name` can have any value.
- `advertised_kafka_api` is the advertised listeners. This `name` should match the name of a declared listener. This `address` is the host name clients use to connect to the broker.
- `kafka_api_tls` is the listener's TLS config. This `name` must match the corresponding listener's name.
:::

See also: [Configure Listeners](../../security/listener-configuration)

## Use rpk with TLS

If you're using `rpk` to interact with the Kafka API using mTLS identity (for example, to manage topics or messages), pass the `--tls-key`, `--tls-cert`, and `--tls-truststore` flags to authenticate.

To interact with the Admin API (for example, to manage users), pass the `--admin-api-tls-key`, `--admin-api-tls-cert`, and `--admin-api-tls-truststore` flags.

```bash
 rpk topic create test-topic \
--tls-key <path-to-PEM-formatted-key-file> \
--tls-cert <path-to-PEM-formatted-cert-file> \
--tls-truststore <path-to-PEM-formatted-CA-file>
```

:::note
Remember to replace variables in brackets.  
:::

<details>
  <summary>
  Example output
  </summary>

  ```bash
  TOPIC       STATUS
  test-topic  OK
  ```
  </details>

To check the configuration of the topic, run:

```bash
rpk topic describe test-topic <tls-flags-from-above>
```

By default, `rpk` connects to `localhost:9092` for Kafka protocol commands. If you're connecting to a remote broker or if you configured your local broker differently, use the `--brokers <address:port>` flag. 

## Suggested reading

- [TLS configuration for Redpanda and rpk](https://redpanda.com/blog/tls-config/)
- [Work with schema registry](../../schema-registry)
