import TunableClusterProperty from '../tiered-storage/_tunable-cluster-props.mdx'

To improve performance and scalability, Redpanda performs object storage housekeeping when the system is idle. This housekeeping includes adjacent segment merging, which analyzes the data layout of the partition in object storage. If it finds a run of small segments, it can merge and reupload the segment.

To determine when the system is idle for housekeeping, Redpanda constantly calculates object storage utilization using the moving average with a sliding window algorithm. The width of the sliding window is defined by the <TunableClusterProperty name="cloud_storage_idle_timeout_ms" frontmatter={props.frontmatter}/> property, which has a default of 10 seconds. If the utilization (requests per second) drops below the threshold, then object storage is considered idle, and object storage housekeeping begins. The threshold is defined by the <TunableClusterProperty name="cloud_storage_idle_threshold_rps" frontmatter={props.frontmatter}/> property, which has a default of one request per second. Object storage is considered idle if, during the last 10 seconds, there were 10 or less object storage API requests.

If the object storage API becomes active after housekeeping begins, then housekeeping is paused until it becomes idle again. If object storage is not idle for <TunableClusterProperty name="cloud_storage_housekeeping_interval_ms milliseconds" frontmatter={props.frontmatter}/>, then housekeeping is forced to run until it completes. This guarantees that all housekeeping jobs are run once for every <TunableClusterProperty name="cloud_storage_housekeeping_interval_ms" frontmatter={props.frontmatter}/>. 